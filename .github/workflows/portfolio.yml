name: CI with MEGA Upload (Windows)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Download and install MEGAcmd silently
      - name: Install MEGAcmd on Windows
        run: |
          Invoke-WebRequest -Uri "https://mega.nz/MEGAcmdSetup64.exe" -OutFile "MEGAcmdSetup64.exe"
          Start-Process .\MEGAcmdSetup64.exe -ArgumentList "/S" -Wait

      # Add MEGAcmd to PATH (MEGAcmd installs into Program Files)
      - name: Add MEGAcmd to PATH
        run: |
          echo "C:\Program Files\MEGAcmd" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

      # Login to MEGA (using GitHub secrets)
      - name: MEGA Login
        run: |
          mega-login "${{ secrets.MEGA_EMAIL }}" "${{ secrets.MEGA_PASSWORD }}"

      # Upload a file (example: README.md to a folder in MEGA cloud)
      - name: Upload file to MEGA
        run: |
          mega-put README.md /GitHubBackups/
